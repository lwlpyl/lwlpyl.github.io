<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>圣诞树</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="bookmark" href="favicon.ico" />
  <link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet">
  <link rel="stylesheet" href="https://www.5div.com/biaobai_shengdanshu/css/style.css">
</head>

<body>
  <div class='glitter glitter_1'></div>
  <div class='glitter glitter_2'></div>
  <div class='glitter glitter_3'></div>
  <div class='glitter glitter_4'></div>
  <div class='glitter glitter_5'></div>
  <div class='glitter glitter_6'></div>
  <div class='glitter glitter_7'></div>
  <div class='glitter glitter_8'></div>
  <div class='glitter glitter_9'></div>
  <div class='glitter glitter_10'></div>
  <div class='glitter glitter_11'></div>
  <div class='glitter glitter_12'></div>
  <div class='glitter glitter_13'></div>
  <div class='glitter glitter_14'></div>
  <div class='glitter glitter_15'></div>
  <div class='glitter glitter_16'></div>
  <div class='glitter glitter_17'></div>
  <div class='glitter glitter_18'></div>
  <div class='glitter glitter_19'></div>
  <div class='glitter glitter_20'></div>
  <div class='glitter glitter_21'></div>
  <div class='glitter glitter_22'></div>
  <div class='glitter glitter_23'></div>
  <div class='glitter glitter_24'></div>
  <div class='glitter glitter_25'></div>
  <div class='glitter glitter_26'></div>
  <div class='glitter glitter_27'></div>
  <div class='glitter glitter_28'></div>
  <div class='glitter glitter_29'></div>
  <div class='glitter glitter_30'></div>
  <div class='container'>
    <div class='tree'>
      <svg enable-background='https://www.5div.com/biaobai_shengdanshu/images/71fdbc41a6d64e4ea54b7c6c477c78c5.gif'
        height='430px' id='Layer_1' version='1.1' viewBox='0 0 380 430' width='380px' x='0px' xml:space='preserve'
        y='0px'>
        <defs>
          <linearGradient id='TreeGradient' x1='0%' x2='0%' y1='0%' y2='100%'>
            <stop offset='5%' stop-color='#022D02'></stop>
            <stop offset='95%' stop-color='#005600'></stop>
          </linearGradient>
        </defs>
        <path
          d='M161.008,410.682 c0,0,18.678,12.452,61.665,2.668c-6.951-27.11-11.265-68.483-11.265-68.483s-34.984-13.342-44.768-2.372 C167.53,379.554,161.008,410.682,161.008,410.682z'
          fill='#5A3412' stroke-miterlimit='10' stroke-width='0.8894'></path>
        <path
          d='M68.807,268.378 c0,0-10.673,57.218-49.51,63.739c0,0,21.346,20.457,44.47,3.559c17.788,26.386,45.359,10.673,45.359,10.673 s22.235,23.123,47.436,2.372c20.751,28.163,57.515,2.075,57.515,2.075s23.123,25.792,48.027-2.669c0,0,31.128,23.125,53.363-5.337 c3.467-1.876,29.35,17.196,46.249-6.226c-43.284-8.005-50.696-64.927-50.696-64.927C300.988,256.354,68.807,268.378,68.807,268.378z'
          fill='url(#TreeGradient)' stroke-miterlimit='10' stroke-width='0.8894'></path>
        <path
          d='M95.785,222.129 c0,0-29.712,52.489-49.213,54.846c0,0,29.943,23.719,53.067,6.819c24.014,24.608,44.856,9.103,44.856,9.103 s26.296,24.694,53.868,2.756c32.61,21.938,44.68,0.061,52.178-5.04c0,0,24.903,16.307,39.404-5.337c0,0,29.079,8.599,41.828-10.375 c-26.386-0.89-44.767-50.104-44.767-50.104C276.975,209.513,95.785,222.129,95.785,222.129z'
          fill='url(#TreeGradient)' stroke-miterlimit='10' stroke-width='0.8894'></path>
        <path
          d='M117.099,158.603 c0,0-30.504,56.707-50.005,59.063c0,0,22.762,19.878,45.886,2.979c24.014,24.608,48.917,8.302,48.917,8.302 s22.235,22.828,49.807,0.891c28.164,17.194,40.234,1.838,47.73-3.262c0,0,35.873,15.415,50.993-10.377 c-26.386-0.889-44.471-54.846-44.471-54.846C255.925,146.069,117.099,158.603,117.099,158.603z'
          fill='url(#TreeGradient)' stroke-miterlimit='10' stroke-width='0.8894'></path>
        <path
          d='M138.773,98.799 c0,0-27.274,54.253-46.776,56.609c0,0,22.762,19.879,45.887,2.98c24.014,24.607,45.009-0.539,45.009-0.539 s27.482,29.948,53.345,0.568c29.423,19.241,48.1-2.401,48.1-2.401c-18.084-1.779-42.098-56.329-42.098-56.329 C232.209,84.404,138.773,98.799,138.773,98.799z'
          fill='url(#TreeGradient)' stroke-miterlimit='10' stroke-width='0.8894'></path>
        <path
          d='M188.875,14.899 c0,0-29.703,62.218-69.726,86.232c0,0,24.663,18.42,47.788,1.521c24.014,20.456,48.027-2.668,48.027-2.668 s20.159,23.718,44.598,1.054C216.872,81.472,188.875,14.899,188.875,14.899z'
          fill='url(#TreeGradient)' stroke-miterlimit='10' stroke-width='0.8894'></path>
      </svg>
    </div>
    <div class='star'></div>
    <span class='light light1'></span>
    <span class='light light2'></span>
    <span class='light light3'></span>
    <span class='light light4'></span>
    <span class='light light5'></span>
    <span class='light light6'></span>
    <span class='light light7'></span>
    <span class='light light8'></span>
    <span class='light light9'></span>
    <span class='light light10'></span>
    <span class='light light11'></span>
    <span class='light light12'></span>
    <span class='light light13'></span>
    <span class='light light14'></span>
    <span class='light light15'></span>
    <span class='light light16'></span>
    <span class='light light17'></span>
    <span class='light light18'></span>
    <span class='light light19'></span>
    <span class='light light20'></span>
    <span class='light light21'></span>
    <span class='light light22'></span>
    <span class='light light23'></span>
    <span class='light light24'></span>
    <span class='light light25'></span>
    <span class='light light26'></span>
    <span class='light light27'></span>
    <span class='light light28'></span>
    <span class='light light29'></span>
    <span class='light light30'></span>
    <div class='shadow'></div>
  </div>
  <h1 style="
    left: unset;
    text-align: center;
    font-size: 6vw;
    width: 100%;
">送给吴嘉嘉宝宝</h1>
  <h1 style="
    left: unset;
    text-align: center;
    top: unset;
    bottom: 0px;
    width: 100%;
">Merry Christmas!</h1>
  <audio autoplay="autoplay" id="music">
    <source src="bg.mp3" type="audio/mpeg">
  </audio>
  <div style="display:none">
    <script type="text/javascript">
      document.addEventListener('click', () => {
        document.getElementById('music').play();
      });
    </script>
    <script>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?3574e441e78f507961a1d3225d77da46";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </div>
</body>

</html>
#!/usr/bin/env python
# coding: utf-8

from sklearn import tree
from sklearn.model_selection import train_test_split
import pandas as pd
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import seaborn as sns

"""
1. 读取数据
"""
data_train = pd.read_csv("./train.csv")
data_test = pd.read_csv("./test.csv")


"""
2. 查看数据
"""
data_train.info()
data_test.info()
data_train.describe()


"""
3. 分析性别与生存情况的关系
"""
is_survived = data_train['Survived'] == 1
survived = data_train[is_survived]
a = survived['Sex'].value_counts()
not_survived = data_train['Survived'] == 0
not_survived = data_train[not_survived]
b = not_survived['Sex'].value_counts()
df = pd.DataFrame({u'幸存': a, u'遇难': b})
df = df.T
plt.rcParams['font.sans-serif'] = ['SimHei']
fig = plt.figure()
fig.set(alpha=0.2)
df.plot.bar(stacked=True)
plt.title(u"性别与生存情况")
plt.xlabel(u"性别")
plt.ylabel(u"人数")
plt.show()


"""
4. 分析船舱等级与生存情况的关系
"""
c = survived['Pclass'].value_counts()
d = not_survived['Pclass'].value_counts()
df2 = pd.DataFrame({u'幸存': c, u'遇难': d})
fig = plt.figure()
fig.set(alpha=0.2)
df2.plot.bar(stacked=True)
plt.title(u"船舱等级与生存情况")
plt.xlabel(u"船舱等级")
plt.ylabel(u"人数")
plt.show()


"""
5. 分析年龄与生存情况的关系
"""
data_train.Age[data_train.Pclass == 1].plot.kde()
data_train.Age[data_train.Pclass == 2].plot.kde()
data_train.Age[data_train.Pclass == 3].plot.kde()
plt.xlabel(u"年龄")
plt.ylabel(u"密度")
plt.title(u"不同舱位等级的乘客年龄分布")
plt.legend((u'一等舱', u'二等舱', u'三等舱'), loc='best')
plt.show()


"""
6. 分析登船港口和生存情况的关系
"""
f = survived['Embarked'].value_counts()
g = not_survived['Embarked'].value_counts()
df4 = pd.DataFrame({u'幸存': f, u'遇难': g})
fig = plt.figure()
fig.set(alpha=0.2)
df4.plot.bar(stacked=True)
plt.title(u"登船港口与生存情况")
plt.xlabel(u"登船港口")
plt.ylabel(u"人数")
plt.show()


"""
7. 数据预处理
"""
full = data_train.append(data_test, ignore_index=True)
full['Age'] = full['Age'].fillna(full['Age'].mean())  # 采用平均值来填充缺失值
full['Fare'] = full['Fare'].fillna(full['Fare'].mean())  # 采用平均值来填充缺失值
full['Embarked'] = full['Embarked'].fillna('S')  # 采用众数来填充缺失值
full['Cabin'] = full['Cabin'].fillna('U')  # 采用众数来填充缺失值
full.info()


"""
8. 特征提取
"""
# 8.1 性别
sex_mapDict = {'male': 1, 'female': 0}
full['Sex'] = full['Sex'].map(sex_mapDict)

# 8.2 登船港口
embarkedDf = pd.DataFrame()
embarkedDf = pd.get_dummies(full['Embarked'], prefix='Embarked')
full = pd.concat([full, embarkedDf], axis=1)
full.drop('Embarked', axis=1, inplace=True)

# 8.3 舱位等级
pclassDf = pd.DataFrame()
pclassDf = pd.get_dummies(full['Pclass'], prefix='Pclass')
full = pd.concat([full, pclassDf], axis=1)
full.drop('Pclass', axis=1, inplace=True)


def getTitle(name):
    str1 = name.split(',')[1]
    str2 = str1.split('.')[0]
    str3 = str2.strip()
    return str3


# 8.4 乘客姓名Name
titleDf = pd.DataFrame()
titleDf['Title'] = full['Name'].map(getTitle)
'''
定义以下几种头衔类别：
Officer政府官员
Royalty王室（皇室）
Mr已婚男士
Mrs已婚妇女
Miss年轻未婚女子
Master有技能的人/教师
'''
# 姓名中头衔字符串与定义头衔类别的映射关系
title_mapDict = {
    "Capt": "Officer",
    "Col": "Officer",
    "Major": "Officer",
    "Jonkheer": "Royalty",
    "Don": "Royalty",
    "Sir": "Royalty",
    "Dr": "Officer",
    "Rev": "Officer",
    "the Countess": "Royalty",
    "Dona": "Royalty",
    "Mme": "Mrs",
    "Mlle": "Miss",
    "Ms": "Mrs",
    "Mr": "Mr",
    "Mrs": "Mrs",
    "Miss": "Miss",
    "Master": "Master",
    "Lady": "Royalty"
}
titleDf['Title'] = titleDf['Title'].map(title_mapDict)
titleDf = pd.get_dummies(titleDf['Title'])  # 使用get_dummies进行one-hot编码
full = pd.concat([full, titleDf], axis=1)
full.drop('Name', axis=1, inplace=True)

# 8.5 船舱号
cabinDf = pd.DataFrame()
'''
舱位号的类别值是首字母，例如：
C85 类别映射为首字母C
'''
full['Cabin'] = full['Cabin'].map(lambda c: c[0])
cabinDf = pd.get_dummies(full['Cabin'], prefix='Cabin') # 使用get_dummies进行one-hot编码，列名前缀是Cabin
full = pd.concat([full, cabinDf], axis=1)
full.drop('Cabin', axis=1, inplace=True)

# 8.6 家庭信息
familyDf = pd.DataFrame()
'''
家庭人数=同代直系亲属数（Parch）+不同代直系亲属数（SibSp）+乘客自己
'''
familyDf['FamilySize'] = full['Parch'] + full['SibSp'] + 1
'''
家庭类别：
小家庭Family_Single：家庭人数=1
中等家庭Family_Small: 2<=家庭人数<=4
大家庭Family_Large: 家庭人数>=5
'''
familyDf['Family_Single'] = familyDf['FamilySize'].map(
    lambda s: 1 if s == 1 else 0)
familyDf['Family_Small'] = familyDf['FamilySize'].map(
    lambda s: 1 if 2 <= s <= 4 else 0)
familyDf['Family_Large'] = familyDf['FamilySize'].map(
    lambda s: 1 if 5 <= s else 0)
full = pd.concat([full, familyDf], axis=1)


"""
9. 特征选择
"""
full_X = pd.concat([titleDf,  # 头衔
                    pclassDf,  # 客舱等级
                    familyDf,  # 家庭大小
                    full['Fare'],  # 船票价格
                    cabinDf,  # 船舱号
                    embarkedDf,  # 登船港口
                    full['Sex']  # 性别
                    ], axis=1)


"""
10. 采用决策树模型进行数据分析
"""
# 10.1 准备训练数据集和测试数据集
sourceRow = 891  # 原始数据集有891行
source_X = full_X.loc[0:sourceRow-1, :]  # 原始数据集：特征
source_y = full.loc[0:sourceRow-1, 'Survived']  # 原始数据集：标签
pred_X = full_X.loc[sourceRow:, :]  # 预测数据集：特征
train_X, test_X, train_y, test_y = train_test_split(
    source_X, source_y, train_size=0.8)

# 10.2 创建模型
model = tree.DecisionTreeClassifier()

# 10.3 训练模型
model.fit(train_X, train_y)

# 10.4 测试模型
model.score(test_X, test_y)

# 10.5 决策树可视化
fig = plt.figure()
fig.set(alpha=0.2)
tree.plot_tree(model, filled = True)
# fig.savefig('out.png')
fig.show()
                        
<html>

<!--
    安装步骤:
    1. 安装rasa：
        - mkdir rasa
        - cd rasa
        - python -m venv venv
        - python -m pip install -U pip
        - pip install rasa==2.8.19
        - rasa init
    2. 替换训练数据集
    3. 训练模型：rasa train
    4. 在credentials.yml中设置socketio
    9. 启动server：rasa run --cors *
    10. 用浏览器打开index.html

    参考:
    - https://rasa.com/docs/rasa/installation
    - https://github.com/cedextech/rasa-chatbot-templates
-->

<head>
    <style type="text/css">
        #rasa-chat-widget-container {
            position: static;
            align-items: center;
        }
    </style>
</head>

<body>
    <h1 style="text-align: center">智能客服对话系统</h1>
    <hr/>
    <div id="rasa-chat-widget" data-websocket-url="http://127.0.0.1:5005/socket.io"></div>
    <script src="https://unpkg.com/@rasahq/rasa-chat" type="application/javascript"></script>
</body>

</html>
